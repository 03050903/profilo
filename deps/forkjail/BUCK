include_defs("//buck_imports/xplat.bzl")  # THIS_IS_FBANDROID

if not THIS_IS_FBANDROID:
    FORKJAIL_EXPORTED_HEADERS = [
        "ForkJail.h",
        "ShmErrorMsg.h",
    ]

    cxx_library(
        name = "forkjail",
        srcs = glob([
            "ForkJail.cpp",
            "ShmErrorMsg.cpp",
        ]),
        headers = glob(
            ["*.h"],
            excludes = FORKJAIL_EXPORTED_HEADERS,
        ),
        header_namespace = "forkjail",
        exported_headers = FORKJAIL_EXPORTED_HEADERS,
        compiler_flags = [
            "-fexceptions",
            "-fPIC",
            "-std=gnu++14",
        ],
        force_static = True,
        visibility = [
            "PUBLIC",
        ],
    )
